# LinkBot ‚Äî –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–ê–Ω—Ç–∏—Ö—Ä—É–ø–∫–æ—Å—Ç—å v3)

*–ë–∞–∑–∞ –¥–ª—è —Ñ–æ—Ä–∫–æ–≤ MamaBot –∏ SizeBot. –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.*

–ê–≤—Ç–æ—Ä—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: —Ç–µ–∫—É—â–∏–π LinkBot/‚ÄúLinkBot‚Äù –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω –≤ ASK-–º–æ–¥—É–ª–µ (–∏—Å—Ç–æ—á–Ω–∏–∫–∏‚Ü©Ô∏è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ø—Ä–æ—Å–º–æ—Ç—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, –ø–∞–Ω–µ–ª—å –∏–∫–æ–Ω–æ–∫, Chat-gate). –ù–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî **–ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —è–¥—Ä–æ** –ø–æ ¬´–ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏¬ª –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **–ê–Ω—Ç–∏—Ö—Ä—É–ø–∫–æ—Å—Ç—å v3**, –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ–ª –ø–æ–¥ –±—É–¥—É—â–∏–µ –±–æ—Ç—ã (MamaBot/SizeBot), –ø—Ä–∏ —ç—Ç–æ–º **–Ω–µ –ª–æ–º–∞—è** —Ä–∞–±–æ—á–∏–µ —á–∞—Å—Ç–∏ –∏ **–Ω–µ —Ç—Ä–æ–≥–∞—è** –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (ENV/Compose).

---

## 0. –¶–µ–ª–∏ –∏ –≥—Ä–∞–Ω–∏—Ü—ã

* –°–¥–µ–ª–∞—Ç—å LinkBot ¬´–±–∞–∑–æ–≤—ã–º –∫–∞—Ä–∫–∞—Å–æ–º¬ª –¥–ª—è –±—É–¥—É—â–∏—Ö —Ñ–æ—Ä–∫–æ–≤ (MamaBot/SizeBot).
* –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å ASK-–º–æ–¥—É–ª—å –ø–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞–º: Chat-gate, –≤–µ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å –∏–∫–æ–Ω–æ–∫, Refine, Delete —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º, Back –∏–∑ üìö.
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥—Å–∏—Å—Ç–µ–º—É **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤**: Save ‚Üí Open ‚Üí View.
* –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥/—Å–æ—Å—Ç–æ—è–Ω–∏—è/–º–∏–≥—Ä–∞—Ü–∏–∏/–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
* –ó–∞–ª–æ–∂–∏—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –ø–æ–¥ MamaBot/SizeBot.

**–ù–µ —Ü–µ–ª–∏:** –º–µ–Ω—è—Ç—å ENV, docker-compose, LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.

---

## 1. –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è / –ê–Ω—Ç–∏—Ö—Ä—É–ø–∫–æ—Å—Ç—å v3 (—è–¥—Ä–æ –ø—Ä–∞–≤–∏–ª)

1. **ENV/Compose immutable** ‚Äî –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å `.env*` –∏ `docker-compose*.yml`.
2. **–ß–∏—Å—Ç—ã–π —á–∞—Ç** ‚Äî –Ω–∏–∫–∞–∫–∏—Ö —Ç–æ—á–µ–∫, ¬´‚Ä¶¬ª –∏–ª–∏ —ç—Ö–∞ –∫–æ–º–∞–Ω–¥.
3. **ASK-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã**:

   * Chat-gate: –µ—Å–ª–∏ OFF ‚Üí –∫–Ω–æ–ø–∫–∞ ¬´–í–∫–ª—é—á–∏—Ç—å —á–∞—Ç¬ª ‚Üí –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ON + ForceReply.
   * –í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è.
   * –û—Ç–≤–µ—Ç = ¬´–ì–æ—Ç–æ–≤–ª—é‚Ä¶¬ª ‚Üí `edit_message_text` ‚Üí –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç.
   * –ü–∞–Ω–µ–ª—å –∏–∫–æ–Ω–æ–∫ (`üíæ üìå üßæ üîÅ üìö üóë`) –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è **–≤—Å–µ–≥–¥–∞**.
   * `üóë` = –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–î–∞/–û—Ç–º–µ–Ω–∞).
   * `üîÅ` = ForceReply —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞.
4. **LLM-–≤—ã–∑–æ–≤—ã** ‚Äî —Ç–æ–ª—å–∫–æ Ask/Refine –∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `chat_on=True`.
5. **–ù–µ–π–º—Å–ø–µ–π—Å—ã** ‚Äî –≤—Å–µ –∫–æ–ª–±—ç–∫–∏ –ø–æ–¥ `ask:*`/`ask:answer:*`.
6. **–°—Ç–µ–π—Ç v3** ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å `last_answer`, `chat_on`, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –ø—Ä–æ–µ–∫—Ç—ã, auto_clear.
7. **–ú–∏–≥—Ä–∞—Ü–∏–∏** ‚Äî —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä—ë–¥, —Å —á—ë—Ç–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏ `YYYYMMDD_HHMM_slug.py`.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–ª–æ–∏:

* **Handlers** (`handlers/ask.py`) ‚Äî —Ç–æ–Ω–∫–∏–π —Å–ª–æ–π.
* **Services** (`services/*`) ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: ask_list, ask_answer, artifacts, projects, llm_pipeline.
* **Domain** ‚Äî –º–æ–¥–µ–ª–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
* **Repos** ‚Äî SQL/ORM.
* **UI** ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
* **Utils** ‚Äî —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ MD, tg-—Ö–µ–ª–ø–µ—Ä—ã.
* **Telemetry** ‚Äî –º–µ—Ç—Ä–∏–∫–∏/–ª–æ–≥–∏.
* **Plugins** ‚Äî –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –¥–ª—è MamaBot/SizeBot.

---

## 3. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

–¢–∞–±–ª–∏—Ü–∞ `artifacts`: id, project_id, kind, title, content_md, source_ids, run_meta, pinned, created_at.
–û–ø–µ—Ä–∞—Ü–∏–∏: save, open, list, pin, summary, delete.
UX: –ø–æ—Å–ª–µ üíæ ‚Üí `üóÇ Open`. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–æ–π.

---

## 4. ASK-Wizard

–î–æ–º–∞—à–Ω—è—è –ø–∞–Ω–µ–ª—å: `üìö List`, `‚ùì Ask`, Auto-clear, `üßπ –°–±—Ä–æ—Å`, `üì• Import last`, –±—é–¥–∂–µ—Ç.
List: 5 –ø–ª–∞—à–µ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –ø–æ–¥ –∫–∞–∂–¥–æ–π `‚ûï/‚úÖ`, `üóë`. –§—É—Ç–µ—Ä ‚¨ÖÔ∏è/‚û°Ô∏è. –ü–æ–∏—Å–∫ üîç.
Ask/Refine: Chat OFF ‚Üí inline –≤–∫–ª—é—á–µ–Ω–∏–µ. –û—Ç–≤–µ—Ç –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è, –ø–∞–Ω–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Ü–µ–ø–ª–µ–Ω–∞.

---

## 5. –†–æ—É—Ç–∏–Ω–≥

ASK-—Ä–æ—É—Ç–µ—Ä –¥–æ–ª–∂–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–µ—Ä–≤—ã–º.
–ü—Ä–µ—Ñ–∏–∫—Å—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã.

---

## 6. –°—Ç–µ–π—Ç v3

JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –≤–µ—Ä—Å–∏–µ–π, chat_on, selected_ids, last_answer (run_id, msg_ids, saved/pinned).

---

## 7. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

* –í—Å–µ –∏–∫–æ–Ω–∫–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ ‚Üí ¬´–£–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ¬ª.
* –î–µ–±–∞—É–Ω—Å –∫–æ–ª–±—ç–∫–æ–≤ –ø–æ run_id.
* –õ–æ–∫–∏ –ø—Ä–∏ save/pin/summary.

---

## 8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ ENV. –§–ª–∞–≥–∏:

* `LLM_DISABLED`,
* `ANSWER_BAR_ICONS_ONLY=1`,
* `ASK_PAGE_SIZE=5`.

---

## 9. –û—à–∏–±–∫–∏ –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è

–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫: UserError, ExpectedFailure, InfraError.
–ú–µ—Ç—Ä–∏–∫–∏: –∫–ª–∏–∫–∏, refine, saves, pins, deletes, —Ç–æ–∫–µ–Ω—ã.

---

## 10. –®–∞–≥–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (—á–µ–∫–ª–∏—Å—Ç)

0. Freeze/–≤–µ—Ç–∫–∞.
1. –†–∞–∑–≤–æ—Ä–æ—Ç –∫–∞—Ç–∞–ª–æ–≥–æ–≤.
2. –†–æ—É—Ç–∏–Ω–≥.
3. –°—Ç–µ–π—Ç v3.
4. List/Search/Pagination.
5. Chat-gate + Ask.
6. Answer-bar.
7. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.
8. Refine.
9. –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è.
10. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.
11. E2E –ø—Ä–∏—ë–º–∫–∞.
12. –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è MamaBot/SizeBot.

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

* **A** ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–ª–±—ç–∫–æ–≤ (`ask:home`, `ask:answer:save:<run_id>` –∏ —Ç. –¥.)
* **B** ‚Äî —Å–∫–≤–æ–∑–Ω–∞—è –ø—Ä–∏—ë–º–∫–∞.
* **C** ‚Äî –∑–∞–ø—É—Å–∫ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ docker-compose.
* **D** ‚Äî –ø–ª–∞–≥–∏–Ω—ã –ø–æ–¥ MamaBot/SizeBot (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã + capabilities.json).

---

üëâ –°–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç —É —Å–µ–±—è –∫–∞–∫ `LinkBot_Refactor_Plan_AntiFragile_v3.md`.

–•–æ—á–µ—à—å, —è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å–æ–±–µ—Ä—É –∫–æ—Ä–æ—Ç–∫–∏–π **roadmap-—á–µ–∫–ª–∏—Å—Ç** (–±–µ–∑ –≤—Å–µ–π —Ç–µ–æ—Ä–∏–∏) ‚Äî —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –¥–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –∏ –æ–Ω —Å—Ä–∞–∑—É –≤–∏–¥–µ–ª –ø–æ—Ä—è–¥–æ–∫ —à–∞–≥–æ–≤?